{% extends "base.html" %}

{% load static %}

{% block title %}Features - Alpha One Labs{% endblock %}
{% block content %}
  <div class="container py-8 max-w-7xl mx-auto px-4 sm:px-6">
    <div class="mb-10">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Platform Features</h1>
      <p class="text-gray-600 dark:text-gray-300 max-w-3xl">
        Alpha One Labs provides a variety of features designed to enhance the learning and teaching experience.
        Explore our growing collection of tools and capabilities created to support your educational journey.
      </p>
    </div>
    <!-- Features Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Get a Grade Feature Card -->
      <div class="feature-card">
        <div class="feature-header">
          <h3>Get a Grade</h3>
          <span class="feature-author">by <a href="https://github.com/GautamSharmaaa">@GautamSharmaaa</a></span>
        </div>
        <div class="feature-content">
          <p>Submit links to your projects, articles, or educational content for peer grading and feedback.</p>
          <ul class="feature-highlights">
            <li>Academic grading scale (A to F)</li>
            <li>Detailed feedback for grades below an A</li>
            <li>Track average grades and improvement over time</li>
          </ul>
          <div class="feature-actions">
            <a href="{% url 'gradeable_link_list' %}" class="btn btn-primary">Try it out</a>
            <div class="feature-feedback">
              <button class="thumbs-up" data-feature-id="grade-link">
                <i class="fa fa-thumbs-up"></i> <span class="count">0</span>
              </button>
              <button class="thumbs-down" data-feature-id="grade-link">
                <i class="fa fa-thumbs-down"></i> <span class="count">0</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Add more feature cards here in the future -->
    </div>
  </div>
  <!-- CSS for Features Page -->
  <style>
      /* Feature Card Styles */
      .feature-card {
          border: 1px solid #e2e8f0;
          border-radius: 0.5rem;
          padding: 1.5rem;
          margin-bottom: 1.5rem;
          transition: all 0.3s ease;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
          height: 100%;
          display: flex;
          flex-direction: column;
      }

      .feature-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          transform: translateY(-2px);
      }

      .feature-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1rem;
          padding-bottom: 1rem;
          border-bottom: 1px solid #e2e8f0;
      }

      .feature-header h3 {
          font-size: 1.25rem;
          font-weight: 600;
          color: #1a202c;
      }

      .dark .feature-header h3 {
          color: #f7fafc;
      }

      .feature-author {
          font-size: 0.875rem;
          color: #718096;
      }

      .feature-author a {
          color: #3182ce;
          transition: color 0.2s;
      }

      .feature-author a:hover {
          color: #2c5282;
          text-decoration: underline;
      }

      .dark .feature-author a {
          color: #63b3ed;
      }

      .dark .feature-author a:hover {
          color: #90cdf4;
      }

      .feature-content {
          flex: 1;
          display: flex;
          flex-direction: column;
      }

      .feature-content p {
          margin-bottom: 1rem;
          color: #4a5568;
      }

      .dark .feature-content p {
          color: #e2e8f0;
      }

      .feature-highlights {
          margin: 1rem 0;
          padding-left: 1.5rem;
          list-style-type: disc;
      }

      .feature-highlights li {
          margin-bottom: 0.5rem;
          color: #4a5568;
      }

      .dark .feature-highlights li {
          color: #e2e8f0;
      }

      .feature-actions {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-top: auto;
          padding-top: 1.5rem;
      }

      .btn {
          padding: 0.5rem 1rem;
          border-radius: 0.375rem;
          font-weight: 500;
          text-align: center;
          transition: all 0.2s;
      }

      .btn-primary {
          background-color: #ed8936;
          color: white;
      }

      .btn-primary:hover {
          background-color: #dd6b20;
      }

      .feature-feedback {
          display: flex;
          gap: 0.75rem;
      }

      .thumbs-up,
      .thumbs-down {
          background: none;
          border: 1px solid #e2e8f0;
          padding: 0.5rem;
          border-radius: 0.25rem;
          display: inline-flex;
          align-items: center;
          gap: 0.25rem;
          cursor: pointer;
          transition: all 0.2s ease;
      }

      .thumbs-up:hover {
          background-color: #f0fff4;
          border-color: #68d391;
      }

      .thumbs-down:hover {
          background-color: #fff5f5;
          border-color: #fc8181;
      }

      .thumbs-up.selected {
          background-color: #f0fff4;
          border-color: #68d391;
          color: #2f855a;
      }

      .thumbs-down.selected {
          background-color: #fff5f5;
          border-color: #fc8181;
          color: #c53030;
      }

      .thumbs-up.voted:not(.selected),
      .thumbs-down.voted:not(.selected) {
          opacity: 0.5;
      }

      .dark .feature-card {
          border-color: #4a5568;
          background-color: #2d3748;
      }

      .dark .feature-header {
          border-bottom-color: #4a5568;
      }

      .dark .thumbs-up,
      .dark .thumbs-down {
          border-color: #4a5568;
          color: #e2e8f0;
      }

      .dark .thumbs-up:hover {
          background-color: rgba(104, 211, 145, 0.1);
      }

      .dark .thumbs-down:hover {
          background-color: rgba(252, 129, 129, 0.1);
      }
  </style>
  <!-- JavaScript for thumbs up/down functionality -->
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          // Get CSRF token
          function getCookie(name) {
              let cookieValue = null;
              if (document.cookie && document.cookie !== '') {
                  const cookies = document.cookie.split(';');
                  for (let i = 0; i < cookies.length; i++) {
                      const cookie = cookies[i].trim();
                      if (cookie.substring(0, name.length + 1) === (name + '=')) {
                          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                          break;
                      }
                  }
              }
              return cookieValue;
          }
          const csrfToken = getCookie('csrftoken');

          // Thumbs up/down functionality
          const thumbsButtons = document.querySelectorAll('.thumbs-up, .thumbs-down');

          thumbsButtons.forEach(button => {
              button.addEventListener('click', async function() {
                  const featureId = this.getAttribute('data-feature-id');
                  const isUpvote = this.classList.contains('thumbs-up');
                  const countElement = this.querySelector('.count');

                  try {
                      const formData = new FormData();
                      formData.append('feature_id', featureId);
                      formData.append('vote', isUpvote ? 'up' : 'down');

                      const response = await fetch('{% url "feature_vote" %}', {
                          method: 'POST',
                          body: formData,
                          headers: {
                              'X-CSRFToken': csrfToken
                          }
                      });

                      if (!response.ok) throw new Error('Network response was not ok');
                      const data = await response.json();

                      // Update the counts
                      const upButton = this.closest('.feature-feedback').querySelector('.thumbs-up');
                      const downButton = this.closest('.feature-feedback').querySelector('.thumbs-down');

                      if (upButton) upButton.querySelector('.count').textContent = data.up_count;
                      if (downButton) downButton.querySelector('.count').textContent = data.down_count;

                      // Disable buttons and highlight selected
                      const parentFeedback = this.closest('.feature-feedback');
                      parentFeedback.querySelectorAll('button').forEach(btn => {
                          btn.disabled = true;
                          btn.classList.add('voted');
                      });

                      this.classList.add('selected');

                      // Store the vote in localStorage to persist the UI state
                      localStorage.setItem(`feature_vote_${featureId}`, isUpvote ? 'up' : 'down');

                  } catch (error) {
                      console.error('Error voting on feature:', error);
                  }
              });
          });

          // Check for existing votes in localStorage and update UI
          thumbsButtons.forEach(button => {
              const featureId = button.getAttribute('data-feature-id');
              const storedVote = localStorage.getItem(`feature_vote_${featureId}`);

              if (storedVote) {
                  const parentFeedback = button.closest('.feature-feedback');
                  parentFeedback.querySelectorAll('button').forEach(btn => {
                      btn.disabled = true;
                      btn.classList.add('voted');
                  });

                  if ((storedVote === 'up' && button.classList.contains('thumbs-up')) ||
                      (storedVote === 'down' && button.classList.contains('thumbs-down'))) {
                      button.classList.add('selected');
                  }
              }
          });
      });
  </script>
{% endblock %}
